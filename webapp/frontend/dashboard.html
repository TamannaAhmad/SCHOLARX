<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ScholarX ‚Äî Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lenis@1.0.6/dist/lenis.css" />
  <script src="https://cdn.jsdelivr.net/npm/lenis@1.0.6/dist/lenis.min.js"></script>

  <link rel="stylesheet" href="styles/dashboard.css?v=25.2" />
  <style>
    /* Gradient motion layer */
    .gradient-motion-layer {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(100, 108, 255, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(255, 140, 255, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(100, 200, 255, 0.1) 0%, transparent 60%);
      background-size: 200% 200%;
      animation: gradientMove 20s ease infinite;
      z-index: -1;
      pointer-events: none;
      opacity: 0.6;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }

    /* Ripple effect */
    .ripple {
      position: absolute;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.7);
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Gradient text animation */
    .gradient-text-animated {
      background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899, #f59e0b);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientFlow 8s ease infinite;
    }

    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Enhanced glassmorphism */
    .glass-card {
      background: rgba(255, 255, 255, 0.1) !important;
      backdrop-filter: blur(12px) saturate(180%);
      -webkit-backdrop-filter: blur(12px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
      border-radius: 16px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15) !important;
      transition: all 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .glass-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.2);
    }

    .glass-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(
        circle at var(--x, 50%) var(--y, 50%),
        rgba(100, 108, 255, 0.1),
        transparent 200px
      );
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      z-index: -1;
    }

    .glass-card:hover::before {
      opacity: 1;
    }

    /* Dark mode text color adjustments */
    .dark-mode {
      background-color: #0f172a;
      color: #f1f5f9;
    }

    .dark-mode h1, .dark-mode h2, .dark-mode h3, .dark-mode h4, .dark-mode h5, .dark-mode h6 {
      color: #f1f5f9;
    }

    .dark-mode p, .dark-mode span, .dark-mode label {
      color: #cbd5e1;
    }

    .dark-mode .glass-card {
      background: rgba(15, 23, 42, 0.7);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .dark-mode .topbar {
      background: rgba(15, 23, 42, 0.7);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .dark-mode .theme-toggle {
      border-color: rgba(255, 255, 255, 0.3);
    }

    .dark-mode .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }

    /* Theme toggle animation */
    .theme-toggle {
      position: relative;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      pointer-events: auto;
      z-index: 10;
    }
    
    .theme-toggle * {
      pointer-events: none; /* Prevent icon from blocking clicks */
    }

    .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .theme-toggle .icon {
      display: inline-block;
      transition: transform 0.3s ease;
    }

    .theme-toggle .icon.anim {
      animation: spin 0.5s ease;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="dashboard-body">
  <!-- Gradient Background Layers -->
  <div class="gradient-mesh-bg" aria-hidden="true"></div>
  <div class="gradient-motion-layer" aria-hidden="true"></div>

  <header class="topbar glass-card">
    <div class="topbar-left">
      <h2 class="topbar-logo gradient-text-animated">ScholarX</h2>
    </div>
    <div class="topbar-center"><span class="topbar-section">Dashboard</span></div>
    <div class="topbar-right">
      <a href="messages.html" class="topbar-link ripple-button">Messages</a>
      <button id="themeToggle" class="theme-toggle ripple-button" aria-label="Toggle theme"><span class="icon">üåû</span></button>
    </div>
  </header>

  <section class="hero-section fade-up parallax-card glass-card animate__animated animate__fadeIn">
    <div class="hero-left">
      <h1 class="hero-title gradient-text-animated">Welcome back, <span id="userName" class="gradient-text-animated">User</span></h1>
      <p class="hero-sub">Let's create something <span class="gradient-text-animated">legendary</span> today.</p>
    </div>
  </section>


  <main class="dashboard-wrapper">
    <section class="stats-section fade-up">
      <div class="stat-card glow-wrapper glass-card ripple-button">
        <div class="stat-icon">üìä</div>
        <h3 id="statProjects" class="counter">0</h3>
        <p>Active Projects</p>
      </div>
      <div class="stat-card glow-wrapper glass-card ripple-button">
        <div class="stat-icon">üë•</div>
        <h3 id="statGroups" class="counter">0</h3>
        <p>Study Groups</p>
      </div>
      <div class="stat-card glow-wrapper glass-card ripple-button">
        <div class="stat-icon">‚úâÔ∏è</div>
        <h3 id="statMessages" class="counter">0</h3>
        <p>Unread Messages</p>
      </div>
    </section>

    <section class="dashboard-grid fade-up">
      <div class="glow-wrapper parallax-card glass-card ripple-button">
        <div class="card">
          <div class="card-icon">üöÄ</div>
          <h3 class="card-title"><span class="gradient-text-animated">Your</span> Projects</h3>
          <p>Manage your current and completed work.</p>
          <a href="project-creation.html" class="btn ripple-button">Create Project</a>
        </div>
      </div>

      <div class="glow-wrapper parallax-card glass-card ripple-button">
        <div class="card">
          <div class="card-icon">üë•</div>
          <h3 class="card-title"><span class="gradient-text-animated">Study</span> Groups</h3>
          <p>Join or create groups with like-minded learners.</p>
          <a href="group-creation.html" class="btn ripple-button">Create Group</a>
        </div>
      </div>

      <div class="glow-wrapper parallax-card glass-card ripple-button">
        <div class="card">
          <div class="card-icon">ü§ñ</div>
          <h3>AI Chatbot</h3>
          <p>Your personal AI learning companion.</p>
          <a href="chatbot.html" class="btn ripple-button">Open Chatbot</a>
        </div>
      </div>

      <div class="glow-wrapper parallax-card glass-card ripple-button">
        <div class="card">
          <div class="card-icon">üí¨</div>
          <h3>Messages</h3>
          <p>Stay updated with project and group notifications.</p>
          <a href="messages.html" class="btn ripple-button">View Messages</a>
        </div>
      </div>
    </section>

    <section class="cta-section fade-up parallax-card glass-card animate__animated animate__fadeIn">
      <div class="cta-content">
        <h2 class="cta-heading gradient-text-animated">Let's build something legendary together üöÄ</h2>
        <a href="group-creation.html" class="btn large ripple-button">Start a Group ‚Üí</a>
      </div>
      <div class="cta-decoration">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
      </div>
    </section>
  </main>

  <script>
    // Smooth scrolling with Lenis
    const lenis = new Lenis({ 
      duration: 1.2, 
      smooth: true, 
      easing: t => 1 - Math.pow(1 - t, 4) 
    });
    
    function raf(time) { 
      lenis.raf(time); 
      requestAnimationFrame(raf); 
    }
    
    requestAnimationFrame(raf);
  </script>

  <!-- ====== THEME MANAGER: consolidated and replace previous theme logic ====== -->
  <script>
  /* ===== Consolidated theme manager ‚Äî replaces old theme IIFE + toggle logic ===== */
  (function () {
    const root = document.documentElement; // <html>
    const body = document.body;
    const THEME_KEY = 'theme';
    const toggleId = 'themeToggle';

    // Helper: apply classes and localStorage
    function applyLocalTheme(mode, persist = true) {
      if (mode === 'dark') {
        root.classList.add('dark-mode');
        body.classList.add('dark-mode');
      } else {
        root.classList.remove('dark-mode');
        body.classList.remove('dark-mode');
      }
      if (persist) localStorage.setItem(THEME_KEY, mode);

      // compatibility hook in dashboard.js (if present)
      if (typeof applyTheme === 'function') {
        try { applyTheme(mode); } catch (e) { console.warn('applyTheme hook failed', e); }
      }
    }

    // Read saved theme, else system preference
    function readPreferredTheme() {
      const saved = localStorage.getItem(THEME_KEY);
      if (saved === 'dark' || saved === 'light') return saved;
      return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    // Immediately set theme to avoid FOUC
    const initial = readPreferredTheme();
    applyLocalTheme(initial, false); // don't re-save right away

    // Listen for system changes if user hasn't explicitly chosen
    if (!localStorage.getItem(THEME_KEY) && window.matchMedia) {
      try {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
          applyLocalTheme(e.matches ? 'dark' : 'light', false);
        });
      } catch (e) {
        // Older browsers may use .addListener
        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        if (mq.addListener) mq.addListener(e => applyLocalTheme(e.matches ? 'dark' : 'light', false));
      }
    }

    // Setup toggle after DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById(toggleId);
      const icon = toggle?.querySelector('.icon');

      // Ensure toggle icon matches effective theme
      if (icon) icon.textContent = root.classList.contains('dark-mode') ? 'üåô' : 'üåû';

      // Small helper for ripple (preserves existing ripple UI)
      function createRipple(event, element) {
        const rect = element.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const ripple = document.createElement('span');
        ripple.className = 'ripple';
        ripple.style.width = ripple.style.height = `${size}px`;
        ripple.style.left = `${(event.clientX || rect.left + rect.width/2) - rect.left - size/2}px`;
        ripple.style.top = `${(event.clientY || rect.top + rect.height/2) - rect.top - size/2}px`;
        element.appendChild(ripple);
        setTimeout(() => ripple.remove(), 650);
      }

      // Toggle handler
      function handleThemeToggle(e) {
        // allow keyboard activation and mouse clicks
        if (e) {
          if (e.type === 'click' && e.button !== 0) return; // ignore non-left clicks
          if (e.clientX !== undefined) createRipple(e, toggle);
        }
        const current = root.classList.contains('dark-mode') ? 'dark' : 'light';
        const next = current === 'dark' ? 'light' : 'dark';
        // add a short transition for smooth change
        root.style.transition = 'background-color 0.45s ease, color 0.35s ease';
        body.style.transition = 'background-color 0.45s ease, color 0.35s ease';
        applyLocalTheme(next, true);

        // animate icon
        const currentIcon = toggle?.querySelector('.icon');
        if (currentIcon) {
          currentIcon.classList.remove('anim');
          void currentIcon.offsetWidth;
          currentIcon.classList.add('anim');
          currentIcon.textContent = next === 'dark' ? 'üåô' : 'üåû';
        }

        // cleanup transition after done
        setTimeout(() => {
          root.style.transition = '';
          body.style.transition = '';
        }, 500);
      }

      if (toggle) {
        // ensure we cleanly attach one listener (prevent duplicates)
        toggle.removeEventListener('click', handleThemeToggle);
        toggle.addEventListener('click', handleThemeToggle, { passive: true });
        // keyboard support (space/enter)
        toggle.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter' || ev.key === ' ') {
            ev.preventDefault();
            handleThemeToggle(ev);
          }
        });
      } else {
        console.warn('Theme toggle button not found (id="' + toggleId + '")');
      }
    });
  })();
  </script>
  <!-- ====== /THEME MANAGER ====== -->

  <script>
    // Remaining original behaviors (counters, ripple for non-theme buttons, parallax, observers, etc.)
    document.addEventListener('DOMContentLoaded', () => {
      // Ripple effect function (for non-theme buttons)
      function createRipple(event, element) {
        const rect = element.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const ripple = document.createElement('span');

        ripple.style.width = ripple.style.height = `${size}px`;
        ripple.style.left = `${event.clientX - rect.left - size/2}px`;
        ripple.style.top = `${event.clientY - rect.top - size/2}px`;
        ripple.classList.add('ripple');

        element.appendChild(ripple);

        // Remove ripple after animation
        setTimeout(() => {
          ripple.remove();
        }, 600);
      }

      // Add ripple effect to all buttons with ripple-button class (except theme toggle)
      document.querySelectorAll('.ripple-button').forEach(button => {
        if (button.id !== 'themeToggle') {
          button.addEventListener('click', (e) => {
            createRipple(e, button);
          });
        }
      });

      // Animate counters
      function animateCounters() {
        const counters = document.querySelectorAll('.counter');
        const speed = 200; // The lower the faster

        counters.forEach(counter => {
          const target = parseInt(counter.getAttribute('data-target') || '5');
          let count = 0;
          const increment = target / speed;

          const updateCount = () => {
            if (count < target) {
              count += increment;
              counter.innerText = Math.ceil(count);
              setTimeout(updateCount, 1);
            } else {
              counter.innerText = target;
            }
          };

          updateCount();
        });
      }

      // Initialize counters with random values for demo
      document.getElementById('statProjects').setAttribute('data-target', Math.floor(Math.random() * 10) + 1);
      document.getElementById('statGroups').setAttribute('data-target', Math.floor(Math.random() * 5) + 1);
      document.getElementById('statMessages').setAttribute('data-target', Math.floor(Math.random() * 20) + 1);

      // Start counter animation when stats section is in view
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            animateCounters();
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.5 });

      const statsSection = document.querySelector('.stats-section');
      if (statsSection) {
        observer.observe(statsSection);
      }

      // Enhanced parallax tilt effect for cards
      const parallaxEls = document.querySelectorAll('.parallax-card, .glass-card, .card, .stat-card, .glow-wrapper');

      parallaxEls.forEach(el => {
        // Skip header elements
        if (el.closest('header')) return;

        el.addEventListener('mousemove', e => {
          const rect = el.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;

          // Set CSS variables for glass card hover effect
          el.style.setProperty('--x', `${x}px`);
          el.style.setProperty('--y', `${y}px`);

          // Calculate rotation based on mouse position
          const rotateX = ((y - centerY) / centerY) * 5;
          const rotateY = ((centerX - x) / centerX) * 5;

          // Apply transform with perspective for 3D tilt effect
          el.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
          el.style.transition = 'none'; // Disable transition during mouse move for smooth tilt

          // Add subtle shadow based on mouse position
          const shadowX = (x / rect.width - 0.5) * 20;
          const shadowY = (y / rect.height - 0.5) * 20;
          el.style.boxShadow = `${shadowX}px ${shadowY}px 30px rgba(0, 0, 0, 0.2)`;
        });

        el.addEventListener('mouseleave', () => {
          el.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
          el.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
          el.style.boxShadow = '0 8px 32px 0 rgba(31, 38, 135, 0.15)';
          el.style.removeProperty('--x');
          el.style.removeProperty('--y');
        });
      });

      // Enhanced wobbly background effect
      document.addEventListener('mousemove', (e) => {
        const x = (e.clientX / window.innerWidth - 0.5) * 30;
        const y = (e.clientY / window.innerHeight - 0.5) * 30;
        document.body.style.backgroundPosition = `calc(50% + ${x}px) calc(50% + ${y}px)`;
      });
      // Glow effect on hover
      document.querySelectorAll('.glow-wrapper').forEach(el => {
        el.addEventListener('mousemove', e => {
          const rect = el.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          el.style.setProperty('--x', `${x}px`);
          el.style.setProperty('--y', `${y}px`);

          // Add pulsing glow on hover
          el.classList.add('glow-active');
        });

        el.addEventListener('mouseleave', () => {
          el.style.removeProperty('--x');
          el.style.removeProperty('--y');
          el.classList.remove('glow-active');
        });
      });

      // Add animation to elements with fade-up class when they come into view
      const fadeElements = document.querySelectorAll('.fade-up');
      const fadeObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate__animated', 'animate__fadeInUp');
            fadeObserver.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });

      fadeElements.forEach(el => fadeObserver.observe(el));
    });
  </script>

  <script src="scripts/dashboard.js"></script>
</body>
</html>
